<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ptp="http://parkcode.com.ua/facelets/ptp"
      xmlns:t="http://myfaces.apache.org/tomahawk"
      xmlns:f="http://java.sun.com/jsf/core">


    <ui:composition template="/WEB-INF/templates/template.xhtml">

        <ui:param name="pageId"  value="profile" />

        <ui:param name="pageTitle" value="Редагування профілю" />


        <ui:define name="body">
            <div class="centeredContent">

                <div class="formContent">
                    <ptp:formTitle value="Редагування профілю" />

                    <ptp:formErrorMessage provider="#{profileEditAction}" rendered="#{loginAction.loggedIn}" />

                    <ui:decorate template="/WEB-INF/templates/message.xhtml">
                        <ui:param name="rendered" value="#{!loginAction.loggedIn}" />
                        <ui:define name="message">
                            Для редагування профілю<br/>
                            Ви повинні увійти на сайт, використовуючи свій акаунт
                        </ui:define>
                    </ui:decorate>


                    <ptp:formSuccessMessage message="Ваш аккаунт успішно оновлений"
                                            rendered="#{loginAction.loggedIn &amp;&amp; profileEditAction.success}" />


                    <h:form prependId="false" rendered="#{loginAction.loggedIn}">
                        <div class="formLine">
                            <ptp:formLabel value="Логін (e-mail)" required="true"/>
                            <div class="inputElem">
                                <h:inputText id="login" value="#{profileEditAction.user.newEmail}"
                                             maxlength="128"  />
                            </div>
                        </div>
                        <div class="formLine">
                            <ptp:formLabel value="Прізвище" required="true" />
                            <div class="inputElem">
                                <h:inputText id="surname" value="#{profileEditAction.user.newSurname}" maxlength="255"
                                             required="true" requiredMessage="Поле обов’язкове" /><br/>
                                <h:message styleClass="errorText" for="surname" />
                            </div>
                        </div>

                        <div class="formLine">
                            <ptp:formLabel value="Ім’я" required="true" />
                            <div class="inputElem">
                                <h:inputText id="name" value="#{profileEditAction.user.newName}" maxlength="255"
                                             required="true" requiredMessage="Поле обов’язкове" /><br/>
                                <h:message styleClass="errorText" for="name" />
                            </div>
                        </div>

                        <div class="formLine">
                            <ptp:formLabel value="По батькові" required="true" />
                            <div class="inputElem">
                                <h:inputText id="patronymic" value="#{profileEditAction.user.newPatronymic}" maxlength="255"
                                             required="true" requiredMessage="По-батькові" /><br/>
                                <h:message styleClass="errorText" for="patronymic" />
                            </div>
                        </div>

                        <div class="formLine">
                            <ptp:formLabel value="Старий пароль" />
                            <div class="inputElem">
                                <h:inputSecret id="password" value="#{profileEditAction.user.password}" maxlength="128" /><br/>
                                <h:message styleClass="errorText" for="password" />
                            </div>
                        </div>

                        <div class="formLine">
                            <ptp:formLabel value="Новий пароль" />
                            <div class="inputElem">
                                <h:inputSecret id="newPassword" value="#{profileEditAction.newPassword}" maxlength="128" /><br/>
                                <h:message styleClass="errorText" for="newPassword" />
                            </div>
                        </div>

                        <div class="formLine">
                            <ptp:formLabel value="Повторіть новий пароль" />
                            <div class="inputElem">
                                <h:inputSecret id="confirmPassword" value="#{profileEditAction.confirmPassword}" maxlength="128" /><br/>
                                <h:message styleClass="errorText" for="confirmPassword" />
                            </div>
                        </div>

                        <div class="formLine">
                            <ptp:formLabel value="Телефон моб.:" required="true" />
                            <div class="inputElem">
                                <h:inputText id="phone" value="#{profileEditAction.user.newPhone}" maxlength="255"
                                             required="true" requiredMessage="Поле обов’язкове" /><br/>
                                <h:message styleClass="errorText" for="phone" />
                            </div>
                        </div>

                        <div class="formLine">
                            <ptp:formLabel value="Дата народження" required="true"/>
                            <div class="dateElem">
                                <t:div>
                                    День <t:selectOneMenu styleClass="selectedDay">
                                        <f:selectItem  itemLabel="1" itemValue="1" /><f:selectItem  itemLabel="2" itemValue="2" /><f:selectItem  itemLabel="3" itemValue="3" />
                                        <f:selectItem  itemLabel="4" itemValue="4" /><f:selectItem  itemLabel="5" itemValue="5" /><f:selectItem  itemLabel="6" itemValue="6" />
                                        <f:selectItem  itemLabel="7" itemValue="7" /><f:selectItem  itemLabel="8" itemValue="8" /><f:selectItem  itemLabel="9" itemValue="9" />
                                        <f:selectItem  itemLabel="10" itemValue="10" /><f:selectItem  itemLabel="11" itemValue="11" /><f:selectItem  itemLabel="12" itemValue="12" />
                                        <f:selectItem  itemLabel="13" itemValue="13" /><f:selectItem  itemLabel="14" itemValue="14" /><f:selectItem  itemLabel="15" itemValue="15" />
                                        <f:selectItem  itemLabel="16" itemValue="16" /><f:selectItem  itemLabel="17" itemValue="17" /><f:selectItem  itemLabel="18" itemValue="18" />
                                        <f:selectItem  itemLabel="19" itemValue="19" /><f:selectItem  itemLabel="20" itemValue="20" /><f:selectItem  itemLabel="21" itemValue="21" />
                                        <f:selectItem  itemLabel="22" itemValue="22" /><f:selectItem  itemLabel="23" itemValue="23" /><f:selectItem  itemLabel="24" itemValue="24" />
                                        <f:selectItem  itemLabel="25" itemValue="25" /><f:selectItem  itemLabel="26" itemValue="26" /><f:selectItem  itemLabel="27" itemValue="27" />
                                        <f:selectItem  itemLabel="28" itemValue="28" /><f:selectItem  itemLabel="29" itemValue="29" /><f:selectItem  itemLabel="30" itemValue="30" />
                                        <f:selectItem  itemLabel="31" itemValue="31" />
                                    </t:selectOneMenu>
                                    Місяць <t:selectOneMenu styleClass="selectedMonth">
                                        <f:selectItem  itemLabel="Січень"   itemValue="1" />
                                        <f:selectItem  itemLabel="Лютий"    itemValue="2" />
                                        <f:selectItem  itemLabel="Березень" itemValue="3" />
                                        <f:selectItem  itemLabel="Квітень"  itemValue="4" />
                                        <f:selectItem  itemLabel="Травень"  itemValue="5" />
                                        <f:selectItem  itemLabel="Червень"  itemValue="6" />
                                        <f:selectItem  itemLabel="Липень"   itemValue="7" />
                                        <f:selectItem  itemLabel="Серпень"  itemValue="8" />
                                        <f:selectItem  itemLabel="Вересень" itemValue="9" />
                                        <f:selectItem  itemLabel="Жовтень"  itemValue="10" />
                                        <f:selectItem  itemLabel="Листопад" itemValue="11" />
                                        <f:selectItem  itemLabel="Грудень"  itemValue="12" />
                                    </t:selectOneMenu>
                                    Рік <t:selectOneMenu styleClass="selectedYear" >
                                        <f:selectItems value="#{profileEditAction.yearsDiapazon(-100,0)}" var="year" itemLabel="#{year}" itemValue="#{year}" />
                                    </t:selectOneMenu>
                                    <h:inputText value="#{profileEditAction.user.stringNewBirthdayDate}" styleClass="calendar" style="display: none"/>

                                    <script type="text/javascript">
                                        function updateSelected(dates) {
                                            $j('.selectedMonth').val(dates.length ? dates[0].getMonth() + 1 : '');
                                            $j('.selectedDay').val(dates.length ? dates[0].getDate() : '');
                                            $j('.selectedYear').val(dates.length ? dates[0].getFullYear() : '');
                                            checkLinkedDays();
                                        }


                                        $j(function() {
                                            $j('.selectedDay,.selectedMonth,.selectedYear').change(checkLinkedDays());
                                        });


                                        function checkLinkedDays()
                                        {
//                              Не использовать метод datepick.daysInMonth он неправильно вычесляет количество дней
                                            year = $j('.selectedYear').val();
                                            month = $j('.selectedMonth').val();
                                            var days = 33 - new Date(year, month - 1, 33).getDate();
                                            var daysInMonth = days;
                                            $j('.selectedDay option:gt(27)').attr('disabled', false);
                                            $j('.selectedDay option:gt(' + (daysInMonth - 1) + ')').attr('disabled', true);
                                            if ($j('.selectedDay').val() > daysInMonth) {
                                                $j('.selectedDay').val(daysInMonth);
                                            }
                                        }
                                        $j(function() {
                                            $j('.calendar').datepick({
                                                yearRange: '-100y:' + new Date().getFullYear(), dateFormat: 'dd.mm.yyyy',
                                                alignment: 'bottomRight', showOnFocus: false,
                                                onSelect: updateSelected,
                                                showTrigger: '.trigger'}, $j.datepick.regional['uk']);
                                        });

                                        $j(document).ready(function() {
                                            var st = $j('.calendar').val();
                                            if (st != "") {
                                                var date = [new Date(st.replace(/(\d{2})\.(\d{2})\.(\d{4})/, '$3-$2-$1'))];
                                                updateSelected(date);
                                            }
                                            else
                                            {
                                                var date = [new Date()];
                                                updateSelected(date);
                                            }
                                        });
                                        $j('.selectedMonth,.selectedDay,.selectedYear').change(function() {
                                            $j('.calendar').datepick('setDate', new Date($j('.selectedYear').val(), $j('.selectedMonth').val() - 1, $j('.selectedDay').val()));
                                        });
                                    </script>
                                </t:div>
                            </div>
                        </div>

                        <div class="formLine formLineFile">
                            <ptp:formLabel value="Стать" required="true"/>
                            <div class="inputElem">
                                <h:selectOneMenu value="#{profileEditAction.user.newSex}" requiredMessage="Поле обов’язкове"
                                                 id="sex" required="true">
                                    <f:selectItem itemLabel="" itemValue=""/>
                                    <f:selectItem itemLabel="Чоловіча" itemValue="Чоловіча"/>
                                    <f:selectItem itemLabel="Жіноча" itemValue="Жіноча"/>
                                </h:selectOneMenu>
                                <h:message styleClass="errorText" for="sex" />
                            </div>
                        </div>


                        <ptp:requiredFieldsInfo />

                        <div class="formLine">
                            <div class="formBottomButtons">
                                <h:outputLink styleClass="formButton" style="float: right; margin-left: 5px;" value="javascript:history.back()" >Відмінити</h:outputLink>
                                <h:commandButton value="Зберегти" action="#{profileEditAction.save}" styleClass="formButton" style="float: right; margin-left: 5px;"/>
                                <h:commandButton value="Стати експертом" rendered="#{!loginAction.currentUser.roleIs(1)}" action="#{expertRegistrationAction.init()}" styleClass="formButton" style="float: right; margin-left: 5px;"/>
                                <h:commandButton value="Анкета експерта" rendered="#{loginAction.currentUser.roleIs(1)}" action="#{expertRegistrationAction.init()}" styleClass="formButton" style="float: right; margin-left: 5px;"/>

                            </div>
                        </div>
                    </h:form>
                </div>
            </div>

        </ui:define>

    </ui:composition>

</html>
